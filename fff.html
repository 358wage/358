<html lang="zh-CN">
<head>
  <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" name="viewport">
  <meta content="yes" name="apple-mobile-web-app-capable">
  <meta content="yes" name="apple-touch-fullscreen">
  <meta content="black" name="apple-mobile-web-app-status-bar-style">
  <meta content="320" name="MobileOptimized">
  <title></title>
<style>
/* 保留原有的动画样式，确保加载效果正常 */
.container {
  width: 100px;
  height: 100px;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  animation: rotate-move 2s ease-in-out infinite;
}
.dot {
  width: 15px;
  height: 15px;
  border-radius: 50%;
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  margin: auto;
}
.dot-3 {
  background-color: #f74d75;
  animation: dot-3-move 2s ease infinite;
}
.dot-2 {
  background-color: #10beae;
  animation: dot-2-move 2s ease infinite;
}
.dot-1 {
  background-color: #ffe386;
  animation: dot-1-move 2s ease infinite;
}
@keyframes dot-3-move {
  20% { transform: scale(1) }
  45% { transform: translateY(-18px) scale(.45) }
  60% { transform: translateY(-25px) scale(.45) }
  80% { transform: translateY(-25px) scale(.45) }
  100% { transform: translateY(0px) scale(1) }
}
@keyframes dot-2-move {
  20% { transform: scale(1) }
  45% { transform: translate(-16px, 12px) scale(.45) }
  60% { transform: translate(-20px, 15px) scale(.45) }
  80% { transform: translate(-20px, 15px) scale(.45) }
  100% { transform: translateY(0px) scale(1) }
}
@keyframes dot-1-move {
  20% { transform: scale(1) }
  45% { transform: translate(16px, 12px) scale(.45) }
  60% { transform: translate(20px, 15px) scale(.45) }
  80% { transform: translate(20px, 15px) scale(.45) }
  100% { transform: translateY(0px) scale(1) }
}
@keyframes rotate-move {
  55% { transform: translate(-50%, -50%) rotate(0deg) }
  80% { transform: translate(-50%, -50%) rotate(360deg) }
  100% { transform: translate(-50%, -50%) rotate(360deg) }
}
.content {
  height: 100%;
  width: 100%;
  position: fixed;
  left: -2px;
  top: -2px;
}
</style>
<body>
<div class="container">
  <div class="dot dot-1"></div>
  <div class="dot dot-2"></div>
  <div class="dot dot-3"></div>
</div>

<script>
// 判断是否为微信浏览器
function isWeChatBrowser() {
  return navigator.userAgent.toLowerCase().indexOf('micromessenger') !== -1;
}

// 检测当前环境是否支持iframe加载目标链接
function checkIframeSupport(targetUrl, callback) {
  var testIframe = document.createElement('iframe');
  testIframe.style.display = 'none';
  testIframe.src = targetUrl;
  
  // 监听加载成功/失败事件
  testIframe.onload = function() {
    document.body.removeChild(testIframe);
    callback(true); // 加载成功，支持iframe
  };
  
  testIframe.onerror = function() {
    document.body.removeChild(testIframe);
    callback(false); // 加载失败，不支持iframe
  };
  
  document.body.appendChild(testIframe);
}

// 主逻辑
var urlParams = new URLSearchParams(window.location.search);
var encodedParam = urlParams.get('c');
var tureurl = encodedParam ? atob(encodedParam) : '';

if (tureurl.includes("http")) {
  if (isWeChatBrowser()) {
    // 微信环境：先检测iframe支持性
    checkIframeSupport(tureurl, function(supported) {
      if (supported) {
        // 支持iframe，正常加载
        setTimeout(function() {
          document.querySelector('.container').style.display = 'none';
        }, 1500);
        var html = '<iframe class="content" onload="bindMouseWhee(this)" src="' + tureurl + '"></iframe>';
        document.writeln(html);
        console.log('微信环境支持iframe，加载链接：' + tureurl);
      } else {
        // 不支持iframe，引导跳转浏览器
        alert('当前链接在微信内无法正常显示，请点击右上角"..."，选择"在浏览器中打开"');
        console.log('微信环境不支持iframe，需跳转浏览器');
      }
    });
  } else {
    // 非微信环境：直接加载
    setTimeout(function() {
      document.querySelector('.container').style.display = 'none';
    }, 1500);
    var html = '<iframe class="content" onload="bindMouseWhee(this)" src="' + tureurl + '"></iframe>';
    document.writeln(html);
    console.log('非微信环境，加载链接：' + tureurl);
  }
} else {
  console.log("未检测到有效链接");
}
</script>

<script>
// 处理鼠标滚轮事件（保留原功能）
var firefox = navigator.userAgent.indexOf('Firefox') != -1;
function MouseWheel(e, doc) {
  e.preventDefault && e.preventDefault();
  e.returnValue = false;
  var up = firefox && e.detail < 0 || e.wheelDelta > 0;
  doc.body.scrollTop = doc.documentElement.scrollTop += up ? -50 : 50;
}
function bindMouseWhee(ifr) {
  try {
    var doc = ifr.contentWindow.document;
    if (firefox) {
      doc.addEventListener('DOMMouseScroll', function(e) {
        MouseWheel(e, doc);
      }, false);
    } else {
      doc.onmousewheel = function(e) {
        MouseWheel(e || ifr.contentWindow.event, doc);
      };
    }
  } catch (e) {
    alert('跨域限制：无法获取iframe滚动事件\n' + e);
  }
}
</script>
</body>
</html>
